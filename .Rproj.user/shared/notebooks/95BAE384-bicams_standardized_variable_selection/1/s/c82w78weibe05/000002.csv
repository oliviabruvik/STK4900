"0",""
"0","threshold_fraction = 0.1"
"0","threshold = floor(nrow(bicams_data_distinct) * threshold_fraction)"
"0",""
"0","## load eve atlas"
"0","eve_t1 <- readEve()"
"0","map <- readEveMap(type='I')"
"0",""
"0","## Pull lesion data"
"0","#load(here('processed_data/bicams_percent_coverage_matrices.rda'))"
"0","load(here('reproducible_processed_data/bicams_percent_coverage_matrices.rda'))"
"0","# ifelse(cleaned_ventricles,"
"0","#   load(here('processed_data/bicams_cleaned_percent_coverage_matrices.rda')),"
"0","#   ifelse(seed_data,"
"0","#          #load(here('reproducible_processed_data/bicams_percent_coverage_matrices.rda')), # data from 27/5"
"0","#          load(here('processed_data2/bicams_percent_coverage_matrices.rda')),  # data from 25/5)"
"0","#          load(here('processed_data/bicams_percent_coverage_matrices.rda')))) # data from 27/1)"
"0","# #   "
"0",""
"0","## Structures"
"0","if (structure_analysis) {"
"0","  labels <- getEveMapLabels(type='I') %>%"
"0","    dplyr::mutate(regions = paste0('region_', integer_label)) %>%"
"0","    dplyr::select(regions, "
"0","                  text_label, "
"0","                  region_labels = integer_label,"
"0","                  structure)"
"0",""
"0","  labels <- labels %>%"
"0","    filter(region_labels != 0) %>%"
"0","    group_by(structure) %>%"
"0","    summarize(regions)"
"0","  "
"0","  labels$structure[labels$structure == 'fornix_(column_and_body)'] <- 'fornix'"
"0","  "
"0","  bicams_rim_percent_coverage[is.na(bicams_rim_percent_coverage)] <- 0"
"0","  bicams_non_rim_percent_coverage[is.na(bicams_non_rim_percent_coverage)] <- 0"
"0","  "
"0","  structure_rim_coverage <- data.frame(matrix(ncol = 88, nrow = 174))"
"0","  colnames(structure_rim_coverage) <- unique(labels$structure)"
"0","  structure_rim_coverage$ID <- bicams_rim_percent_coverage$ID"
"0","  "
"0","  structure_non_rim_coverage <- structure_rim_coverage"
"0","  "
"0","  for (i in unique(labels$structure)) {"
"0","    regions <- filter(labels, structure == i)$regions"
"0","    structure_rim_coverage[,i] <- bicams_rim_percent_coverage[regions[1]] + bicams_rim_percent_coverage[regions[2]]"
"0","    }"
"0","  "
"0","  for (i in unique(labels$structure)) {"
"0","    regions <- filter(labels, structure == i)$regions"
"0","    structure_non_rim_coverage[,i] <- bicams_non_rim_percent_coverage[regions[1]] + bicams_non_rim_percent_coverage[regions[2]]"
"0","  }"
"0","  "
"0","  if (collapsed_structures) {"
"0","    structure_non_rim_coverage <- structure_non_rim_coverage %>%"
"0","      transmute(amygdala,"
"0","                angular_gyrus,"
"0","                angular_wm,"
"0","                corona_radiata = anterior_corona_radiata + posterior_corona_radiata + superior_corona_radiata,"
"0","                limb_of_internal_capsule = anterior_limb_of_internal_capsule + posterior_limb_of_internal_capsule,"
"0","                corpus_callosum = body_of_corpus_callosum + genu_of_corpus_callosum + splenium_of_corpus_callosum,"
"0","                caudate_nucleus,"
"0","                cerebellum = cerebellum + cerebellum_wm,"
"0","                cerebral_peduncle = inferior_cerebellar_peduncle + cerebral_peduncle + middle_cerebellar_peduncle + superior_cerebellar_peduncle,"
"0","                cingulum = `cingulum_(cingulate_gyrus)` + `cingulum_(hippocampus)` + `cingulum_wm` + cingulate_gyrus,"
"0","                corticospinal_tract, "
"0","                cuneus = cuneus + cuneus_wm,"
"0","                entorhinal_area,"
"0","                external_capsule, "
"0","                fornix = fornix + `fornix(cres)_stria_terminalis`,"
"0","                fusiform = fusiform_gyrus + fusiform_wm,"
"0","                globus_pallidus,"
"0","                gyrus_rectus,"
"0","                hippocampus,"
"0","                frontal_gyrus = inferior_frontal_gyrus + middle_frontal_gyrus + superior_frontal_gyrus,"
"0","                frontal_wm = inferior_frontal_wm + middle_frontal_wm + superior_frontal_wm,"
"0","                fronto_occipital_fasciculus = inferior_fronto_occipital_fasciculus + superior_fronto_occipital_fasciculus,"
"0","                occipital_gyrus = inferior_occipital_gyrus + middle_occipital_gyrus + superior_occipital_gyrus,"
"0","                occipital_wm = middle_occipital_wm + inferior_occipital_wm + superior_occipital_wm,"
"0","                temporal_gyrus = inferior_temporal_gyrus + middle_temporal_gyrus + superior_temporal_gyrus,"
"0","                temporal_wm = middle_temporal_wm + inferior_temporal_wm + superior_temporal_wm,"
"0","                insular,"
"0","                orbital_gyrus = lateral_fronto_orbital_gyrus + middle_fronto_orbital_gyrus,"
"0","                orbital_wm = lateral_fronto_orbital_wm + middle_fronto_orbital_wm,"
"0","                lingual = lingual_gyrus + lingual_wm,"
"0","                medial_lemniscus,"
"0","                medulla,"
"0","                midbrain,"
"0","                parahippocampal_gyrus,"
"0","                pons,"
"0","                pontine_crossing_tract,"
"0","                postcentral_gyrus,"
"0","                posterior_thalamic_radiation,"
"0","                pre_cuneus = pre_cuneus + pre_cuneus_wm,"
"0","                precentral_gyrus,"
"0","                putamen,"
"0","                rectus_wm,"
"0","                red_nucleus,"
"0","                retrolenticular_part_of_internal_capsule,"
"0","                sagittal_stratum,"
"0","                substancia_nigra,"
"0","                superior_longitudinal_fasciculus,"
"0","                superior_parietal_lobule,"
"0","                superior_parietal_wm, "
"0","                supramarginal_wm,"
"0","                tapatum,"
"0","                uncinate_fasciculus,"
"0","                ID = ID)"
"0","    "
"0","    structure_rim_coverage <- structure_rim_coverage %>%"
"0","      transmute(amygdala,"
"0","                angular_gyrus,"
"0","                angular_wm,"
"0","                corona_radiata = anterior_corona_radiata + posterior_corona_radiata + superior_corona_radiata,"
"0","                limb_of_internal_capsule = anterior_limb_of_internal_capsule + posterior_limb_of_internal_capsule,"
"0","                corpus_callosum = body_of_corpus_callosum + genu_of_corpus_callosum + splenium_of_corpus_callosum,"
"0","                caudate_nucleus,"
"0","                cerebellum = cerebellum + cerebellum_wm,"
"0","                cerebral_peduncle = inferior_cerebellar_peduncle + cerebral_peduncle + middle_cerebellar_peduncle + superior_cerebellar_peduncle,"
"0","                cingulum = `cingulum_(cingulate_gyrus)` + `cingulum_(hippocampus)` + `cingulum_wm` + cingulate_gyrus,"
"0","                corticospinal_tract, "
"0","                cuneus = cuneus + cuneus_wm,"
"0","                entorhinal_area,"
"0","                external_capsule, "
"0","                fornix = fornix + `fornix(cres)_stria_terminalis`,"
"0","                fusiform = fusiform_gyrus + fusiform_wm,"
"0","                globus_pallidus,"
"0","                gyrus_rectus,"
"0","                hippocampus,"
"0","                frontal_gyrus = inferior_frontal_gyrus + middle_frontal_gyrus + superior_frontal_gyrus,"
"0","                frontal_wm = inferior_frontal_wm + middle_frontal_wm + superior_frontal_wm,"
"0","                fronto_occipital_fasciculus = inferior_fronto_occipital_fasciculus + superior_fronto_occipital_fasciculus,"
"0","                occipital_gyrus = inferior_occipital_gyrus + middle_occipital_gyrus + superior_occipital_gyrus,"
"0","                occipital_wm = middle_occipital_wm + inferior_occipital_wm + superior_occipital_wm,"
"0","                temporal_gyrus = inferior_temporal_gyrus + middle_temporal_gyrus + superior_temporal_gyrus,"
"0","                temporal_wm = middle_temporal_wm + inferior_temporal_wm + superior_temporal_wm,"
"0","                insular,"
"0","                orbital_gyrus = lateral_fronto_orbital_gyrus + middle_fronto_orbital_gyrus,"
"0","                orbital_wm = lateral_fronto_orbital_wm + middle_fronto_orbital_wm,"
"0","                lingual = lingual_gyrus + lingual_wm,"
"0","                medial_lemniscus,"
"0","                medulla,"
"0","                midbrain,"
"0","                parahippocampal_gyrus,"
"0","                pons,"
"0","                pontine_crossing_tract,"
"0","                postcentral_gyrus,"
"0","                posterior_thalamic_radiation,"
"0","                pre_cuneus = pre_cuneus + pre_cuneus_wm,"
"0","                precentral_gyrus,"
"0","                putamen,"
"0","                rectus_wm,"
"0","                red_nucleus,"
"0","                retrolenticular_part_of_internal_capsule,"
"0","                sagittal_stratum,"
"0","                substancia_nigra,"
"0","                superior_longitudinal_fasciculus,"
"0","                superior_parietal_lobule,"
"0","                superior_parietal_wm, "
"0","                supramarginal_wm,"
"0","                tapatum,"
"0","                uncinate_fasciculus,"
"0","                ID = ID)"
"0","  }"
"0","  "
"0","  structure_rim_coverage[structure_rim_coverage == 0] <- NA"
"0","  structure_non_rim_coverage[structure_non_rim_coverage == 0] <- NA"
"0","  "
"0","  bicams_rim_data <- structure_rim_coverage %>%"
"0","    #dplyr::select_if(vars(length(na.omit(.)) >= 34))"
"0","    dplyr::select_if(vars(length(na.omit(.)) >= floor(nrow(bicams_data_distinct) * threshold_fraction)))"
"0","    "
"0","    "
"0","  bicams_non_rim_data <- structure_non_rim_coverage %>%"
"0","    #dplyr::select_if(vars(length(na.omit(.)) >= 34))"
"0","    dplyr::select_if(vars(length(na.omit(.)) >= floor(nrow(bicams_data_distinct) * threshold_fraction)))"
"0","    #dplyr::select_if(~ !is.numeric(.) || sum(.) != 0)"
"0","  "
"0","} else {"
"0","  bicams_rim_data <- bicams_rim_percent_coverage %>%"
"0","    dplyr::select_if(vars(length(na.omit(.)) >= floor(nrow(bicams_data_distinct) * threshold_fraction))) %>%"
"0","    dplyr::select(-region_0)"
"0","  bicams_non_rim_data <- bicams_non_rim_percent_coverage %>%"
"0","    dplyr::select_if(vars(length(na.omit(.)) >= floor(nrow(bicams_data_distinct) * threshold_fraction))) %>%"
"0","    dplyr::select(-region_0)"
"0","}"
"0",""
"0",""
"0","if (binarize) {"
"0","  ID <- bicams_non_rim_data$ID"
"0","  bicams_non_rim_data[bicams_non_rim_data > 0] <- 1"
"0","  bicams_non_rim_data$ID <- ID"
"0","  "
"0","  ID <- bicams_rim_data$ID"
"0","  bicams_rim_data[bicams_rim_data > 0] <- 1"
"0","  bicams_rim_data$ID <- ID"
"0","}"
"0",""
"0",""
"0","## Merge lesion and BICAMS data"
"0","# raw_bicams_rim_data <- bicams_rim_data %>%"
"0","#   left_join(raw_bicams_data)"
"0","# raw_bicams_non_rim_data <- bicams_non_rim_data %>%"
"0","#   left_join(raw_bicams_data)"
"0","# "
"0","# st_bicams_rim_data <- bicams_rim_data %>%"
"0","#   left_join(st_bicams_data)"
"0","# st_bicams_non_rim_data <- bicams_non_rim_data %>%"
"0","#   left_join(st_bicams_data)"
"0",""
"0","bicams_rim_data <- bicams_rim_data %>%"
"0","  left_join(bicams_patient_data)"
"0","bicams_non_rim_data <- bicams_non_rim_data %>%"
"0","  left_join(bicams_patient_data)"
"0",""
"0","sdmt_rim_data <- bicams_rim_data %>%"
"0","  filter(!is.na(SDMT))"
"0","sdmt_non_rim_data <- bicams_non_rim_data %>%"
"0","  filter(!is.na(SDMT))"
"0",""
"0","bicams_non_rim_data[is.na(bicams_non_rim_data)] <- 0"
"0","bicams_rim_data[is.na(bicams_rim_data)] <- 0"
"0",""
"0","sdmt_non_rim_data[is.na(sdmt_non_rim_data)] <- 0"
"0","sdmt_rim_data[is.na(sdmt_rim_data)] <- 0"
"0",""
"0",""
"0","# raw_bicams_non_rim_data[is.na(raw_bicams_non_rim_data)] <- 0"
"0","# raw_bicams_rim_data[is.na(raw_bicams_rim_data)] <- 0"
"0","# "
"0","# st_bicams_non_rim_data[is.na(st_bicams_non_rim_data)] <- 0"
"0","# st_bicams_rim_data[is.na(st_bicams_rim_data)] <- 0"
"0",""
